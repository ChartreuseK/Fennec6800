 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 1 - 03/17/2023 02:51:32 AM


       1/       0 :                     ; Fennec 6800 ROM monitor/mini-OS
       2/       0 :                     ; 2022/2023 Chartreuse 
       3/       0 :                     ;
       4/       0 :                     ; Usage:
       5/       0 :                     ;   All commands begin with a single letter, addr/ess are specified
       6/       0 :                     ;   as a full 16-bit (4 digit) hex value, and data as a full 8-bit
       7/       0 :                     ;   (2 digit) hex value. 
       8/       0 :                     ;   There is no backspace as input is processed immediately.
       9/       0 :                     ;   Invalid characters are silently ignored.
      10/       0 :                     ;   If a mistake is made, press ESC (Ctrl-[) to cancel the line and
      11/       0 :                     ;   return to the prompt.
      12/       0 :                     ;
      13/       0 :                     ;   Commands:
      14/       0 :                     ;    E - (E)xamine RAM, performs a hex dump from between two specified
      15/       0 :                     ;        addresses. The dash between addresses is NOT entered by the 
      16/       0 :                     ;        user but automatically by the monitor
      17/       0 :                     ;        eg.
      18/       0 :                     ;           E0000-0010
      19/       0 :                     ;        OUTPUT:
      20/       0 :                     ;	    0000: 00 20 08 20 00 00 DF 46 2C 0E 6F 36 7E FA 08 7E
      21/       0 :                     ;  
      22/       0 :                     ;    D - (D)eposit RAM, allows the user to enter hex data in memory 
      23/       0 :                     ;        starting at the specified address. After entering the address
      24/       0 :                     ;        the starting address will be displayed and the user can then
      25/       0 :                     ;        start entering bytes. After every byte (2 digits) entered a 
      26/       0 :                     ;        space will be returned showing the byte has been entered into
      27/       0 :                     ;        RAM. Every 16 bytes a newline and the next address will be 
      28/       0 :                     ;        displayed similar to the examine command. Press return or ESC
      29/       0 :                     ;        after you are done with entering bytes.
      30/       0 :                     ;	 eg. 
      31/       0 :                     ;            D0100
      32/       0 :                     ;            0100:12 34(ESC)
      33/       0 :                     ;            *
      34/       0 :                     ;    G - (G)oto address. Jumps to the specified address and resumes
      35/       0 :                     ;        execution at that point. This is performed as a subroutine 
      36/       0 :                     ;        jump, so if a program preserves the monitors stack, it can 
      37/       0 :                     ;        RTS back into the monitor.
      38/       0 :                     ;        eg.
      39/       0 :                     ;             G0100
      40/       0 :                     ;
      41/       0 :                     ;    R - (R)ecv XMODEM. Recieves a program using XMODEM (checksum) 
      42/       0 :                     ;        starting at the specified address. After specifying address
      43/       0 :                     ;        the user will be prompted to start the xmodem transfer on 
      44/       0 :                     ;        the remote computer. At this point start the transfer and when
      45/       0 :                     ;        completed you will be returned to the monitor prompt. If the
      46/       0 :                     ;        prompt is not visible, try hitting ESC to get it to reprint.
      47/       0 :                     ;        eg.
      48/       0 :                     ;             R0100
      49/       0 :                     ;             SEND FILE NOW
      50/       0 :                     ;             [user starts xmodem transfer in their terminal program]
      51/       0 :                     ;             *
      52/       0 :                     ;
      53/       0 :                     ;    S - (S)end XMODEM. Sends a block of memory using XMODEM (checksum)
      54/       0 :                     ;        from between the two specified addresses. After specifying the
      55/       0 :                     ;        second address, the user will be prompted to start an xmodem
      56/       0 :                     ;        recieve on their terminal. At this point, start the transfer
      57/       0 :                     ;        and when completed you will be returned to the monitor prompt.
      58/       0 :                     ;        If the prompt is not visible, try hitting ESC to get it to
      59/       0 :                     ;        reprint.
      60/       0 :                     ;        eg.
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 2 - 03/17/2023 02:51:32 AM


      61/       0 :                     ;             S0100-0200
      62/       0 :                     ;             RECV FILE NOW
      63/       0 :                     ;             [user starts xmodem recieve in their terminal program]
      64/       0 :                     ;             *
      65/       0 :                     ;
      66/       0 :                     ; Changelog
      67/       0 :                     ;-----------------------------------------------------------------------
      68/       0 :                     ; 0.3.2
      69/       0 :                     ;   Added AUX to device routine options (DEVIN/DEVOUT/DEVINNB)
      70/       0 :                     ; 0.3.1
      71/       0 :                     ;   Added option rom detection and execution
      72/       0 :                     ; 0.3 
      73/       0 :                     ;   Converted to changable I/O routine pointers in preparation for 
      74/       0 :                     ;   VTI board and other option roms to change the default console and
      75/       0 :                     ;   others.
      76/       0 :                     ;
      77/       0 :                     ; 0.2 Added XMODEM send and recieve
      78/       0 :                     ; 0.1 Initial version
      79/       0 :                     ;-----------------------------
      80/       0 :                     	CPU 6800
      81/       0 :                     
      82/       0 :                     ;-----------------------------------------------------------------------
      83/       0 :                     ; Address constants
      84/       0 : =$1FFF               RAMTOP	EQU $1FFF	; Last address to try sizing till
      85/       0 :                     			; $1FFF = Full 8kB system (16x 2114 sram)
      86/       0 : =$FF                 MONSTK	EQU $00FF	; Monitor reserves first 256 bytes of RAM
      87/       0 : =$8000               PSTART	EQU $8000	; Start of peripheral block
      88/       0 : =$4                  ROMSPA	EQU $04		; Spacing between option ROMS to test at *256
      89/       0 : =$E0                 ENDROM	EQU $E0		; Check all the way till EXP0
      90/       0 : =$F10F               MAGIC	EQU $F10F	; Magic word for option ROMS
      91/       0 : =$F1                 MAGIC0	EQU $F1
      92/       0 : =$F                  MAGIC1	EQU $0F
      93/       0 :                     
      94/       0 : =$EFF0               UART1	EQU $EFF0	; Onboard UART A (lower port)
      95/       0 : =$EFF2               UART2	EQU $EFF2	; Onboard UART B (upper port)
      96/       0 :                     
      97/       0 :                     ;-----------------------------------------------------------------------
      98/       0 :                     ; Constants
      99/       0 : ='*'                 PROMPT	EQU '*'
     100/       0 :                     
     101/       0 :                     ; ASCII constants
     102/       0 : =$1                  SOH	EQU $01
     103/       0 : =$4                  EOT	EQU $04
     104/       0 : =$6                  ACK	EQU $06
     105/       0 : =$15                 NAK	EQU $15
     106/       0 : =$17                 ETB	EQU $17
     107/       0 : =$1B                 ESC	EQU $1B
     108/       0 :                     
     109/       0 :                     ;-----------------------------------------------------------------------
     110/       0 :                     ; Option ROM setup
     111/       0 : =$F10F               ROMSIG	EQU $F10F	; Signature to load ROM
     112/       0 : =$A                  ROMNLEN	EQU 10		; Length of ROM name
     113/       0 : =$10                 ROMOFF	EQU 16		; Code start byte of ROM
     114/       0 :                     
     115/       0 :                     ;-----------------------------------------------------------------------
     116/       0 :                     ; Variables
     117/       0 : =$0                  ADDRT	EQU $0000	; 2 - Temp address 
     118/       0 : =$2                  RAMKB	EQU $0002	; 1 - # of kB of ram
     119/       0 : =$3                  BYTET	EQU $0003	; 1 - Temp byte
     120/       0 : =$4                  ADDRP	EQU $0004	; 2 - printing address
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 3 - 03/17/2023 02:51:32 AM


     121/       0 : =$6                  TIMER	EQU $0006	; 2 - timer for delays
     122/       0 : =$8                  SEQ	EQU $0008	; 1 - Current block for XMODEM
     123/       0 : =$9                  CSUM	EQU $0009	; 1 - Current checksum for XMODEM
     124/       0 : =$A                  COUNT	EQU $000A	; 1 - Count of bytes (XMODEM)
     125/       0 : =$B                  LAST	EQU $000B	; 1 - Last acknowledgement (XMODEM)
     126/       0 :                     ; Controllable routines
     127/       0 :                     ;  - expect no reg preserved, result if any in A
     128/       0 : =$C                  CONTR	EQU $000C	; Start of controllable routines
     129/       0 :                     
     130/       0 : =$C                  CONIN	EQU CONTR	; 3 - JMP to GETC routine for console
     131/       0 : =$F                  CONOUT	EQU CONIN+3	; 3 - JMP TO PUTC routine for console
     132/       0 : =$12                 CONINNB	EQU CONOUT+3	; 3 - JMP to GETC (non-blocking) for console
     133/       0 :                     
     134/       0 : =$15                 AUXIN	EQU CONINNB+3	; 3 - JMP to GETC routine for aux 
     135/       0 : =$18                 AUXOUT	EQU AUXIN+3	; 3 - JMP TO PUTC routine for aux 
     136/       0 : =$1B                 AUXINNB	EQU AUXOUT+3	; 3 - JMP to GETC (non-blocking) for aux
     137/       0 :                     
     138/       0 : =$1E                 DEVIN	EQU AUXINNB+3	; 3 - JMP to device routine GETC
     139/       0 : =$21                 DEVOUT	EQU DEVIN+3	; 3 - JMP to device routine PUTC
     140/       0 : =$24                 DEVINNB	EQU DEVOUT+3	; 3 - JMP to device routine GETC (non-blocking)
     141/       0 :                     			;  Device routines take device # in B
     142/       0 :                     			;  0 = console, 1 = aux, 2 = uart a, 3 = uart b, 
     143/       0 :                     			;  4+ rom or user defined
     144/       0 : =$27                 CONTRE	EQU DEVINNB+3	; End of controllable routines
     145/       0 :                     
     146/       0 :                     
     147/       0 :                     
     148/       0 :                     
     149/       0 :                     
     150/       0 :                     
     151/       0 :                     ;CONOUT EQU S0OUT
     152/       0 :                     ;CONIN EQU S0IN
     153/       0 :                     ;-----------------------------------------------------------------------
     154/       0 :                     ; Program
     155/    F800 :                     	ORG $F800	; 2kB ROM
     156/    F800 :                     START
     157/    F800 : 7E F8 1E            	JMP ENTER
     158/    F803 :                     ; Default controllable routines
     159/    F803 :                     DEFRT
     160/    F803 : 7E FA 6D            	JMP S0IN
     161/    F806 : 7E FA 83            	JMP S0OUT
     162/    F809 : 7E FA 99            	JMP S0IN_NB
     163/    F80C : 7E FA 78            	JMP S1IN
     164/    F80F : 7E FA 8E            	JMP S1OUT
     165/    F812 : 7E FA A7            	JMP S1IN_NB
     166/    F815 : 7E FA B5            	JMP DDEVIN
     167/    F818 : 7E FA D1            	JMP DDEVOUT
     168/    F81B : 7E FA ED            	JMP DDEVINNB
     169/    F81E :                     DEFRTE
     170/    F81E : =$1B                 DEFRTLEN EQU *-DEFRT
     171/    F81E :                     
     172/    F81E :                     
     173/    F81E :                     ENTER
     174/    F81E : 8E 00 FF            	LDS #MONSTK	; Stack pointer
     175/    F821 : BD FA 08            	JSR UARTINIT
     176/    F824 : BD FA 19            	JSR CONTINIT	; Initialize controlable routines
     177/    F827 : BD FA 2D            	JSR RAMSIZE	; Size ram
     178/    F82A : BD F8 BC            	JSR FINDROM	; Find and run any option roms
     179/    F82D : BD FA 59            	JSR BANNER
     180/    F830 : BD F8 E2            	JSR PRINTROM	; Find roms and print their names
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 4 - 03/17/2023 02:51:32 AM


     181/    F833 :                     	
     182/    F833 : 8E 00 FF            WARMST	LDS #MONSTK	; Reset Stack pointer
     183/    F836 : BD FB 09            LOOP	JSR NEWLINE
     184/    F839 : 86 2A               	LDAA #PROMPT
     185/    F83B : BD 00 0F            	JSR CONOUT
     186/    F83E : BD 00 0C            LOOPI	JSR CONIN
     187/    F841 : BD FB 1E            	JSR TOUPPER	; Convert to upper
     188/    F844 : 81 45               	CMPA #'E'	; Examine
     189/    F846 : 27 16               	BEQ EXAMINE
     190/    F848 : 81 44               	CMPA #'D'	; Deposit
     191/    F84A : 27 1A               	BEQ DEPOSIT
     192/    F84C : 81 47               	CMPA #'G'	; Goto      
     193/    F84E : 27 1E               	BEQ GOTO
     194/    F850 : 81 52               	CMPA #'R'	; XMODEM Recieve
     195/    F852 : 27 23               	BEQ XRECV
     196/    F854 : 81 53               	CMPA #'S'	; XMODEM Send
     197/    F856 : 27 2C               	BEQ XSEND
     198/    F858 : 81 0D               	CMPA #'\r'
     199/    F85A : 27 DA               	BEQ LOOP
     200/    F85C : 20 E0               	BRA LOOPI	; Invalid character
     201/    F85E :                     EXAMINE
     202/    F85E : BD F8 91            	JSR ADDR2
     203/    F861 : BD F9 63            	JSR DUMP
     204/    F864 : 20 D0               	BRA LOOP
     205/    F866 : BD F8 9B            DEPOSIT	JSR ADDR1
     206/    F869 : BD F9 1B            	JSR DEPLOOP
     207/    F86C : 20 C8               	BRA LOOP
     208/    F86E : BD F8 9B            GOTO	JSR ADDR1
     209/    F871 : DE 00               	LDX ADDRT
     210/    F873 : AD 00               	JSR 0,X
     211/    F875 : 20 BF               	BRA LOOP
     212/    F877 : BD F8 9B            XRECV	JSR ADDR1
     213/    F87A : 86 01               	LDAA #1		; Send message
     214/    F87C : BD F8 A5            	JSR XMSG
     215/    F87F : BD FB 29            	JSR XMDMRECV
     216/    F882 : 20 B2               	BRA LOOP
     217/    F884 : BD F8 91            XSEND	JSR ADDR2
     218/    F887 : 86 00               	LDAA #0		; Recv message
     219/    F889 : BD F8 A5            	JSR XMSG
     220/    F88C : BD FB CB            	JSR XMDMSEND
     221/    F88F : 20 A5               	BRA LOOP
     222/    F891 :                     ; Address prompts for command
     223/    F891 :                     ADDR2:
     224/    F891 : BD 00 0F            	JSR CONOUT
     225/    F894 : BD F9 97            	JSR READADDR
     226/    F897 : 86 2D               	LDAA #'-'
     227/    F899 : DE 00               	LDX ADDRT
     228/    F89B : BD 00 0F            ADDR1:	JSR CONOUT
     229/    F89E : BD F9 97            	JSR READADDR
     230/    F8A1 : BD FB 09            	JSR NEWLINE
     231/    F8A4 : 39                  	RTS
     232/    F8A5 :                     ; Xmodem messages
     233/    F8A5 :                     XMSG:
     234/    F8A5 : DF 04               	STX ADDRP	; Save address
     235/    F8A7 : CE FC 64            	LDX #S_RECV
     236/    F8AA : 4D                  	TSTA 
     237/    F8AB : 27 03               	BEQ .RECV
     238/    F8AD : CE FC 5F            	LDX #S_SEND
     239/    F8B0 : BD FB 13            .RECV	JSR PRINTSTR
     240/    F8B3 : CE FC 69            	LDX #S_FILE
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 5 - 03/17/2023 02:51:32 AM


     241/    F8B6 : BD FB 13            	JSR PRINTSTR
     242/    F8B9 : DE 04               	LDX ADDRP	; Restore addr
     243/    F8BB : 39                  	RTS
     244/    F8BC :                     ;-----------------------------------------------------------------------
     245/    F8BC :                     ; Find and execute any option roms	
     246/    F8BC :                     FINDROM
     247/    F8BC : CE 80 00            	LDX #PSTART	; Start of peripheral block
     248/    F8BF :                     .LOOP
     249/    F8BF : 86 F1               	LDAA #MAGIC0
     250/    F8C1 : A1 00               	CMPA 0,X
     251/    F8C3 : 26 06               	BNE .NEXT
     252/    F8C5 : 86 0F               	LDAA #MAGIC1
     253/    F8C7 : A1 01               	CMPA 1,X
     254/    F8C9 : 27 0F               	BEQ .FOUND	; Both magic # match
     255/    F8CB : DF 00               .NEXT	STX ADDRT
     256/    F8CD : 96 00               	LDAA ADDRT
     257/    F8CF : 8B 04               	ADDA #ROMSPA	; Move to next addr to check
     258/    F8D1 : 97 00               	STAA ADDRT
     259/    F8D3 : DE 00               	LDX ADDRT
     260/    F8D5 : 81 E0               	CMPA #ENDROM	; Have we reached the last block to check?
     261/    F8D7 : 25 E6               	BCS .LOOP	; (unsigned LT) Continue if not past last addr
     262/    F8D9 : 39                  	RTS		; Last block, we're done
     263/    F8DA :                     .FOUND	; Found a valid signature
     264/    F8DA : DF 00               	STX ADDRT	; Preserve address
     265/    F8DC : AD 10               	JSR 16,X	; Jump to 16th byte of ROM to start
     266/    F8DE : DE 00               	LDX ADDRT	; We're back, restore and keep looking
     267/    F8E0 : 20 E9               	BRA .NEXT
     268/    F8E2 :                     	
     269/    F8E2 :                     ;-----------------------------------------------------------------------
     270/    F8E2 :                     ; Find and print option rom names	
     271/    F8E2 :                     ;  We can't do this in the FINDROM routine as the console may be defined
     272/    F8E2 :                     ;  by an option ROM (like the VTI)
     273/    F8E2 :                     PRINTROM
     274/    F8E2 : CE FC 75            	LDX #S_OPTION
     275/    F8E5 : BD FB 13            	JSR PRINTSTR
     276/    F8E8 : CE 80 00            	LDX #PSTART	; Start of peripheral block
     277/    F8EB :                     .LOOP
     278/    F8EB : 86 F1               	LDAA #MAGIC0
     279/    F8ED : A1 00               	CMPA 0,X
     280/    F8EF : 26 06               	BNE .NEXT
     281/    F8F1 : 86 0F               	LDAA #MAGIC1
     282/    F8F3 : A1 01               	CMPA 1,X
     283/    F8F5 : 27 0F               	BEQ .FOUND	; Both magic # match
     284/    F8F7 : DF 00               .NEXT	STX ADDRT
     285/    F8F9 : 96 00               	LDAA ADDRT
     286/    F8FB : 8B 04               	ADDA #ROMSPA	; Move to next addr to check
     287/    F8FD : 97 00               	STAA ADDRT
     288/    F8FF : DE 00               	LDX ADDRT
     289/    F901 : 81 E0               	CMPA #ENDROM	; Have we reached the last block to check?
     290/    F903 : 25 E6               	BCS .LOOP	; (unsigned LT) Continue if not past last addr
     291/    F905 : 39                  	RTS		; Last block, we're done
     292/    F906 :                     .FOUND	; Found a valid signature
     293/    F906 : DF 00               	STX ADDRT	; Preserve address
     294/    F908 : DF 04               	STX ADDRP	; For printing
     295/    F90A : BD F9 EB            	JSR PRINTWORD
     296/    F90D : 86 2D               	LDAA #'-'
     297/    F90F : BD 00 0F            	JSR CONOUT
     298/    F912 : 08                  	INX
     299/    F913 : 08                  	INX		; String starts from 2nd byte of ROM
     300/    F914 : BD FB 13            	JSR PRINTSTR
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 6 - 03/17/2023 02:51:32 AM


     301/    F917 : DE 00               	LDX ADDRT	; Restore and resume
     302/    F919 : 20 DC               	BRA .NEXT
     303/    F91B :                     	
     304/    F91B :                     
     305/    F91B :                     	
     306/    F91B :                     	
     307/    F91B :                     ;-----------------------------------------------------------------------
     308/    F91B :                     DEPLOOP
     309/    F91B : DE 00               	LDX ADDRT
     310/    F91D :                     .NEXT
     311/    F91D : DF 04               	STX ADDRP
     312/    F91F : BD F9 EB            	JSR PRINTWORD
     313/    F922 : 86 3A               	LDAA #':'
     314/    F924 : BD 00 0F            	JSR CONOUT
     315/    F927 : C6 10               	LDAB #16	; Max 16 per line
     316/    F929 :                     .LOOP
     317/    F929 : 37                  	PSHB
     318/    F92A :                     .IGNORE
     319/    F92A : BD 00 0C            	JSR CONIN
     320/    F92D : BD FB 1E            	JSR TOUPPER
     321/    F930 : 81 1B               	CMPA #ESC
     322/    F932 : 26 03               	BNE .T2
     323/    F934 : 7E F8 33            	JMP WARMST
     324/    F937 : 81 0D               .T2	CMPA #'\r'
     325/    F939 : 27 26               	BEQ .DONE
     326/    F93B : 81 30               	CMPA #'0'
     327/    F93D : 2D EB               	BLT .IGNORE
     328/    F93F : 81 39               	CMPA #'9'
     329/    F941 : 2F 08               	BLE .DIGIT
     330/    F943 : 81 41               	CMPA #'A'
     331/    F945 : 2D E3               	BLT .IGNORE
     332/    F947 : 81 46               	CMPA #'F'
     333/    F949 : 2E DF               	BGT .IGNORE
     334/    F94B : BD F9 8E            .DIGIT	JSR READBYTEP
     335/    F94E : 96 03               	LDAA BYTET
     336/    F950 : A7 00               	STAA 0,X
     337/    F952 : 08                  	INX
     338/    F953 : 86 20               	LDAA #' '
     339/    F955 : BD 00 0F            	JSR CONOUT
     340/    F958 : 33                  	PULB
     341/    F959 : 5A                  	DECB
     342/    F95A : 26 CD               	BNE .LOOP
     343/    F95C : BD FB 09            	JSR NEWLINE
     344/    F95F : 20 BC               	BRA .NEXT
     345/    F961 : 33                  .DONE	PULB
     346/    F962 : 39                  	RTS
     347/    F963 :                     	
     348/    F963 :                     ;-----------------------------------------------------------------------
     349/    F963 :                     ; Dump hex from addr in X to ADDRT
     350/    F963 :                     DUMP
     351/    F963 :                     	; Print addr 1st column
     352/    F963 : DF 04               	STX ADDRP
     353/    F965 : BD F9 EB            	JSR PRINTWORD
     354/    F968 : 86 3A               	LDAA #':'
     355/    F96A : BD 00 0F            	JSR CONOUT
     356/    F96D : C6 10               	LDAB #16	; Print 16 bytes per line
     357/    F96F :                     .LOOP
     358/    F96F : 37                  	PSHB
     359/    F970 : 86 20               	LDAA #' '
     360/    F972 : BD 00 0F            	JSR CONOUT
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 7 - 03/17/2023 02:51:32 AM


     361/    F975 : A6 00               	LDAA 0,X
     362/    F977 : BD F9 F2            	JSR PRINTBYTE
     363/    F97A : 33                  	PULB
     364/    F97B : 08                  	INX
     365/    F97C : 9C 00               	CPX ADDRT
     366/    F97E : 27 0D               	BEQ .DONE
     367/    F980 : 5A                  	DECB	
     368/    F981 : 26 EC               	BNE .LOOP
     369/    F983 : BD FB 09            	JSR NEWLINE
     370/    F986 : BD 00 12            	JSR CONINNB	; Check if user wants intervention
     371/    F989 : 81 1B               	CMPA #ESC
     372/    F98B : 26 D6               	BNE DUMP
     373/    F98D :                     .DONE
     374/    F98D : 39                  	RTS
     375/    F98E :                     	
     376/    F98E :                     ;-----------------------------------------------------------------------
     377/    F98E :                     ; Read byte with first character preset
     378/    F98E :                     READBYTEP 
     379/    F98E : C6 00               	LDAB #0
     380/    F990 : D7 03               	STAB BYTET
     381/    F992 : C6 02               	LDAB #2
     382/    F994 : 37                  	PSHB
     383/    F995 : 20 23               	BRA READBYTE.NEXT3
     384/    F997 :                     	
     385/    F997 :                     ;-----------------------------------------------------------------------
     386/    F997 :                     ; Read in 2 byte address
     387/    F997 :                     READADDR
     388/    F997 : BD F9 A6            	JSR READBYTE
     389/    F99A : 96 03               	LDAA BYTET
     390/    F99C : 97 00               	STAA ADDRT
     391/    F99E : BD F9 A6            	JSR READBYTE
     392/    F9A1 : 96 03               	LDAA BYTET
     393/    F9A3 : 97 01               	STAA ADDRT+1
     394/    F9A5 : 39                  	RTS
     395/    F9A6 :                     ;-----------------------------------------------------------------------
     396/    F9A6 :                     ; Read in 1 byte in hex
     397/    F9A6 :                     READBYTE
     398/    F9A6 : 86 00               	LDAA #0
     399/    F9A8 : 97 03               	STAA BYTET
     400/    F9AA : C6 02               	LDAB #2		; Expect 2 digits
     401/    F9AC : 37                  .NEXT	PSHB
     402/    F9AD : BD 00 0C            .NEXT2	JSR CONIN
     403/    F9B0 : BD FB 1E            	JSR TOUPPER
     404/    F9B3 : 81 1B               	CMPA #ESC
     405/    F9B5 : 26 03               	BNE .NEXT3
     406/    F9B7 : 7E F8 33            	JMP WARMST
     407/    F9BA : 81 30               .NEXT3	CMPA #'0'
     408/    F9BC : 2D EF               	BLT .NEXT2	; Ignore
     409/    F9BE : 81 39               	CMPA #'9'
     410/    F9C0 : 2F 0F               	BLE .DIGIT
     411/    F9C2 : 81 41               	CMPA #'A'
     412/    F9C4 : 2D E7               	BLT .NEXT2	; Ignore
     413/    F9C6 : 81 46               	CMPA #'F'
     414/    F9C8 : 2E E3               	BGT .NEXT2	; Ignore
     415/    F9CA : BD 00 0F            	JSR CONOUT
     416/    F9CD :                     	; A-F
     417/    F9CD : 80 07               	SUBA #'A'-':'	; Convert to 3A-3F
     418/    F9CF : 20 03               	BRA .DIGIT2
     419/    F9D1 :                     .DIGIT
     420/    F9D1 : BD 00 0F            	JSR CONOUT
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 8 - 03/17/2023 02:51:32 AM


     421/    F9D4 :                     .DIGIT2
     422/    F9D4 : 78 00 03            	ASL BYTET
     423/    F9D7 : 78 00 03            	ASL BYTET
     424/    F9DA : 78 00 03            	ASL BYTET
     425/    F9DD : 78 00 03            	ASL BYTET
     426/    F9E0 : 80 30               	SUBA #'0'
     427/    F9E2 : 9B 03               	ADDA BYTET
     428/    F9E4 : 97 03               	STAA BYTET
     429/    F9E6 : 33                  	PULB
     430/    F9E7 : 5A                  	DECB
     431/    F9E8 : 26 C2               	BNE .NEXT	; Go till we get all digits
     432/    F9EA : 39                  	RTS		; Address in BYTET
     433/    F9EB :                     	
     434/    F9EB :                     ;-----------------------------------------------------------------------
     435/    F9EB :                     PRINTWORD
     436/    F9EB : 96 04               	LDAA ADDRP
     437/    F9ED : BD F9 F2            	JSR PRINTBYTE
     438/    F9F0 : 96 05               	LDAA ADDRP+1
     439/    F9F2 :                     	; Fall into printbyte
     440/    F9F2 :                     ;-----------------------------------------------------------------------
     441/    F9F2 :                     PRINTBYTE
     442/    F9F2 : 36                  	PSHA
     443/    F9F3 : 47                  	ASR A
     444/    F9F4 : 47                  	ASR A
     445/    F9F5 : 47                  	ASR A
     446/    F9F6 : 47                  	ASR A
     447/    F9F7 : BD F9 FB            	JSR PRINTNYB
     448/    F9FA : 32                  	PULA
     449/    F9FB :                     	; Fall into printnyb
     450/    F9FB :                     ;-----------------------------------------------------------------------
     451/    F9FB :                     PRINTNYB
     452/    F9FB : 84 0F               	ANDA #$0F
     453/    F9FD : 8B 30               	ADDA #'0'
     454/    F9FF : 81 39               	CMPA #'9'
     455/    FA01 : 2F 02               	BLE .NOFIX
     456/    FA03 : 8B 07               	ADDA #'A'-':'
     457/    FA05 : 7E 00 0F            .NOFIX	JMP CONOUT
     458/    FA08 :                     	; Tail call
     459/    FA08 :                     	
     460/    FA08 :                     ;-----------------------------------------------------------------------
     461/    FA08 :                     ; Initialize both UARTs
     462/    FA08 :                     UARTINIT
     463/    FA08 : 86 03               	LDAA #$03	; Master reset
     464/    FA0A : B7 EF F0            	STAA UART1
     465/    FA0D : B7 EF F2            	STAA UART2
     466/    FA10 : 86 15               	LDAA #$15	; /16 8N1, RTS asserted no interrupts
     467/    FA12 : B7 EF F0            	STAA UART1
     468/    FA15 : B7 EF F2            	STAA UART2
     469/    FA18 : 39                  	RTS
     470/    FA19 :                     
     471/    FA19 :                     CONTINIT
     472/    FA19 : CE F8 1D            	LDX #DEFRTE-1	; End of default set in X
     473/    FA1C : 9F 00               	STS ADDRT	; Store stack pointer
     474/    FA1E : 8E 00 26            	LDS #CONTRE-1	; End of controllable
     475/    FA21 :                     	
     476/    FA21 : C6 1B               	LDAB #DEFRTLEN	; Number of bytes to copy
     477/    FA23 : A6 00               .COPY	LDAA 0,X
     478/    FA25 : 36                  	PSHA		; Copy using stack operations
     479/    FA26 : 09                  	DEX
     480/    FA27 : 5A                  	DECB
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 9 - 03/17/2023 02:51:32 AM


     481/    FA28 : 26 F9               	BNE .COPY
     482/    FA2A :                     	; Routines copied restore stack
     483/    FA2A : 9E 00               	LDS ADDRT
     484/    FA2C : 39                  	RTS
     485/    FA2D :                     	
     486/    FA2D :                     ;-----------------------------------------------------------------------
     487/    FA2D :                     ; We assume that at least 1kB of RAM has to exist since we're using 
     488/    FA2D :                     ; subroutines here. So the first bank must be populated. Test up till
     489/    FA2D :                     ; RAMTOP (8kB by default)
     490/    FA2D :                     RAMSIZE
     491/    FA2D : CE 04 00            	LDX #$0400	; Start just after 1kB
     492/    FA30 : DF 00               	STX ADDRT
     493/    FA32 : C6 01               	LDAB #1		; Count of KB
     494/    FA34 : 86 55               .SIZE	LDAA #$55	; Store 55AA
     495/    FA36 : A7 04               	STAA 4,X       
     496/    FA38 : 86 AA               	LDAA #$AA
     497/    FA3A : A7 05               	STAA 5,X
     498/    FA3C :                     	
     499/    FA3C : 86 55               	LDAA #$55	; Do a readback test
     500/    FA3E : A1 04               	CMPA 4,X
     501/    FA40 : 26 14               	BNE .FAIL
     502/    FA42 : 86 AA               	LDAA #$AA
     503/    FA44 : A1 05               	CMPA 5,X
     504/    FA46 : 26 0E               	BNE .FAIL
     505/    FA48 :                     	; Readback fine, check next kB
     506/    FA48 : 5C                  	INCB
     507/    FA49 : 96 00               	LDAA ADDRT
     508/    FA4B : 8B 04               	ADDA #4
     509/    FA4D : 97 00               	STAA ADDRT
     510/    FA4F : DE 00               	LDX ADDRT	; Next pointer to check
     511/    FA51 :                     	
     512/    FA51 : 8C 1F FF            	CPX #RAMTOP
     513/    FA54 : 2D DE               	BLT .SIZE
     514/    FA56 : D7 02               .FAIL   STAB RAMKB	; Save kB count
     515/    FA58 : 39                  	RTS
     516/    FA59 :                     ;-----------------------------------------------------------------------
     517/    FA59 :                     
     518/    FA59 :                     ; Print out the banner and ram size
     519/    FA59 :                     BANNER
     520/    FA59 : CE FC 36            	LDX #S_BANNER
     521/    FA5C : BD FB 13            	JSR PRINTSTR
     522/    FA5F : 96 02               	LDAA RAMKB
     523/    FA61 : 8B 30               	ADDA #'0'
     524/    FA63 : BD 00 0F            	JSR CONOUT
     525/    FA66 : CE FC 49            	LDX #S_MEM
     526/    FA69 : BD FB 13            	JSR PRINTSTR
     527/    FA6C : 39                  	RTS
     528/    FA6D :                     ;-----------------------------------------------------------------------
     529/    FA6D :                     ; Onboard UART routines
     530/    FA6D : C6 01               S0IN	LDAB #$01	; Receive data full
     531/    FA6F : F5 EF F0            .L      BITB UART1      
     532/    FA72 : 27 FB               	BEQ .L
     533/    FA74 : B6 EF F1            	LDAA UART1+1
     534/    FA77 : 39                  	RTS
     535/    FA78 : C6 01               S1IN	LDAB #$01	; Receive data full
     536/    FA7A : F5 EF F2            .L      BITB UART2      
     537/    FA7D : 27 FB               	BEQ .L
     538/    FA7F : B6 EF F3            	LDAA UART2+1
     539/    FA82 : 39                  	RTS
     540/    FA83 : C6 02               S0OUT	LDAB #$02	; Transmit data empty
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 10 - 03/17/2023 02:51:32 AM


     541/    FA85 : F5 EF F0            .L:	BITB UART1
     542/    FA88 : 27 FB               	BEQ .L
     543/    FA8A : B7 EF F1            	STAA UART1+1	; Send character
     544/    FA8D : 39                  	RTS
     545/    FA8E : C6 02               S1OUT	LDAB #$02	; Transmit data empty
     546/    FA90 : F5 EF F2            .L:	BITB UART2
     547/    FA93 : 27 FB               	BEQ .L
     548/    FA95 : B7 EF F3            	STAA UART2+1	; Send character
     549/    FA98 : 39                  	RTS
     550/    FA99 :                     ; Non-blocking, 23 cycles (for XMODEM timeout)
     551/    FA99 : 86 00               S0IN_NB	LDAA #0		; 2 - Default return
     552/    FA9B : C6 01               	LDAB #$01	; 2 - 
     553/    FA9D : F5 EF F0            	BITB UART1	; 4 -
     554/    FAA0 : 27 03               	BEQ .E		; 4 -
     555/    FAA2 : B6 EF F1            	LDAA UART1+1	; 4 -
     556/    FAA5 : 4D                  .E	TST A		; 2 - Set flags based on A
     557/    FAA6 : 39                  	RTS		; 5-
     558/    FAA7 :                     ; Non-blocking, 23 cycles (for XMODEM timeout)
     559/    FAA7 : 86 00               S1IN_NB	LDAA #0		; 2 - Default return
     560/    FAA9 : C6 01               	LDAB #$01	; 2 - 
     561/    FAAB : F5 EF F2            	BITB UART2	; 4 -
     562/    FAAE : 27 03               	BEQ .E		; 4 -
     563/    FAB0 : B6 EF F3            	LDAA UART2+1	; 4 -
     564/    FAB3 : 4D                  .E	TST A		; 2 - Set flags based on A
     565/    FAB4 : 39                  	RTS		; 5-
     566/    FAB5 :                     
     567/    FAB5 :                     ;-----------------------------------------------------------------------
     568/    FAB5 :                     ; Default device routines
     569/    FAB5 :                     DDEVIN
     570/    FAB5 : 5D                  	TSTB
     571/    FAB6 : 27 0D               	BEQ	.CON
     572/    FAB8 : C1 01               	CMPB #1
     573/    FABA : 27 0C               	BEQ	.AUX
     574/    FABC : C1 02               	CMPB #2
     575/    FABE : 27 0B               	BEQ	.S0
     576/    FAC0 : C1 03               	CMPB #3
     577/    FAC2 : 27 0A               	BEQ	.S1
     578/    FAC4 :                     	; Invalid ignore
     579/    FAC4 : 39                  	RTS
     580/    FAC5 : 7E 00 0C            .CON	JMP CONIN
     581/    FAC8 : 7E 00 15            .AUX	JMP AUXIN
     582/    FACB : 7E FA 6D            .S0	JMP S0IN
     583/    FACE : 7E FA 78            .S1	JMP S1IN
     584/    FAD1 :                     
     585/    FAD1 :                     
     586/    FAD1 :                     DDEVOUT
     587/    FAD1 : 5D                  	TSTB
     588/    FAD2 : 27 0D               	BEQ	.CON
     589/    FAD4 : C1 01               	CMPB #1
     590/    FAD6 : 27 0C               	BEQ	.AUX
     591/    FAD8 : C1 02               	CMPB #2
     592/    FADA : 27 0B               	BEQ	.S0
     593/    FADC : C1 03               	CMPB #3
     594/    FADE : 27 0A               	BEQ	.S1
     595/    FAE0 :                     	; Invalid ignore
     596/    FAE0 : 39                  	RTS
     597/    FAE1 : 7E 00 0F            .CON	JMP CONOUT
     598/    FAE4 : 7E 00 18            .AUX	JMP AUXOUT
     599/    FAE7 : 7E FA 83            .S0	JMP S0OUT
     600/    FAEA : 7E FA 8E            .S1	JMP S1OUT
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 11 - 03/17/2023 02:51:32 AM


     601/    FAED :                     
     602/    FAED :                     DDEVINNB
     603/    FAED : 5D                  	TSTB
     604/    FAEE : 27 0D               	BEQ	.CON
     605/    FAF0 : C1 01               	CMPB #1
     606/    FAF2 : 27 0C               	BEQ	.AUX
     607/    FAF4 : C1 02               	CMPB #2
     608/    FAF6 : 27 0B               	BEQ	.S0
     609/    FAF8 : C1 03               	CMPB #3
     610/    FAFA : 27 0A               	BEQ	.S1
     611/    FAFC :                     	; Invalid ignore
     612/    FAFC : 39                  	RTS
     613/    FAFD : 7E 00 12            .CON	JMP CONINNB
     614/    FB00 : 7E 00 1B            .AUX	JMP AUXINNB
     615/    FB03 : 7E FA 99            .S0	JMP S0IN_NB
     616/    FB06 : 7E FA A7            .S1	JMP S1IN_NB
     617/    FB09 :                     
     618/    FB09 :                     	
     619/    FB09 :                     ;-----------------------------------------------------------------------
     620/    FB09 :                     ; Print newline
     621/    FB09 : 86 0D               NEWLINE	LDAA #'\r'
     622/    FB0B : BD 00 0F            	JSR CONOUT
     623/    FB0E : 86 0A               	LDAA #'\n'
     624/    FB10 : 7E 00 0F            	JMP CONOUT	; Tail call
     625/    FB13 :                     	
     626/    FB13 :                     ;-----------------------------------------------------------------------
     627/    FB13 :                     ; Print null terminated string in X
     628/    FB13 :                     PRINTSTR
     629/    FB13 : A6 00               	LDAA 0,X
     630/    FB15 : 27 06               	BEQ .END
     631/    FB17 : BD 00 0F            	JSR CONOUT
     632/    FB1A : 08                  	INX
     633/    FB1B : 20 F6               	BRA PRINTSTR
     634/    FB1D : 39                  .END    RTS
     635/    FB1E :                     
     636/    FB1E :                     ;-----------------------------------------------------------------------
     637/    FB1E :                     ; Convert to uppercase
     638/    FB1E :                     TOUPPER
     639/    FB1E : 81 61               	CMPA #'a'
     640/    FB20 : 2D 06               	BLT .DONE
     641/    FB22 : 81 7A               	CMPA #'z'
     642/    FB24 : 2E 02               	BGT .DONE
     643/    FB26 : 84 DF               	ANDA #$DF	; Convert
     644/    FB28 : 39                  .DONE	RTS
     645/    FB29 :                     
     646/    FB29 :                     ;-----------------------------------------------------------------------
     647/    FB29 :                     ; Revieve program over xmodem, loaded starting at $0100
     648/    FB29 :                     XMDMRECV
     649/    FB29 : CE 00 00            	LDX #0
     650/    FB2C : DF 06               	STX TIMER	; Reset timeout
     651/    FB2E : DF 08               	STX SEQ		; Clear seq and CSUM
     652/    FB30 : 7C 00 08            	INC SEQ		; Set first sequence to 1
     653/    FB33 : DE 00               	LDX ADDRT	; Destination pointer
     654/    FB35 :                     	; Send NAK, and wait for start
     655/    FB35 : 86 15               .START	LDAA #NAK
     656/    FB37 : 97 0B               	STAA LAST
     657/    FB39 : BD 00 0F            	JSR CONOUT
     658/    FB3C : BD 00 12            .AWAIT	JSR CONINNB	; 9+23, 32 -
     659/    FB3F : 26 0C               	BNE .GOT1	; 4 -
     660/    FB41 : 7C 00 07            	INC TIMER+1	; 6 - Timeout counter
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 12 - 03/17/2023 02:51:32 AM


     661/    FB44 : 28 F6               	BVC .AWAIT	; 4- (Each loop is 46 cycles * 256 = 11776 (12.7ms)
     662/    FB46 : 7C 00 06            	INC TIMER+0	; 6 - 
     663/    FB49 : 28 F1               	BVC .AWAIT	; 4 - Each loop is 11786 * 256 = 3,017,216 cycles
     664/    FB4B :                     			; At 921.6kHz this takes at least 3.27 seconds to happen
     665/    FB4B : 20 E8               	BRA .START	; Try again
     666/    FB4D :                     .GOT1	; We got a character, is it our start of packet
     667/    FB4D : 81 01               	CMPA #SOH
     668/    FB4F : 26 E4               	BNE .START	; It's not, continue trying.
     669/    FB51 : 86 00               	LDAA #0
     670/    FB53 : 97 06               	STAA TIMER
     671/    FB55 : 97 07               	STAA TIMER+1
     672/    FB57 :                     	; Start of 1st packet, let the protocol begin
     673/    FB57 : 20 33               	BRA .S1A	; Skip waiting for SOH
     674/    FB59 : BD 00 12            .S1	JSR CONINNB
     675/    FB5C : 26 1E               	BNE .GOT2
     676/    FB5E : 7C 00 07            	INC TIMER+1
     677/    FB61 : 28 F6               	BVC .S1		; Each loop is 12.7ms
     678/    FB63 :                     	; Sender probably lost our last reply, resend
     679/    FB63 : 96 0B               	LDAA LAST
     680/    FB65 : BD 00 0F            	JSR CONOUT
     681/    FB68 : 7C 00 06            	INC TIMER	; Use upper count of timer as timeout loop
     682/    FB6B : D6 06               	LDAB TIMER
     683/    FB6D : C1 0A               	CMPB #10	; 10 tries before giving up
     684/    FB6F : 27 02               	BEQ .TIMEOUT
     685/    FB71 : 20 E6               	BRA .S1
     686/    FB73 :                     .TIMEOUT
     687/    FB73 : CE FC 55            	LDX #S_TIME
     688/    FB76 : BD FB 13            	JSR PRINTSTR
     689/    FB79 : 7E F8 1E            	JMP ENTER	; Cold start
     690/    FB7C :                     .GOT2
     691/    FB7C : C6 00               	LDAB #0
     692/    FB7E : D7 07               	STAB TIMER+1	; Reset timers
     693/    FB80 : D7 06               	STAB TIMER+0
     694/    FB82 : D7 09               	STAB CSUM	; Reset checksum
     695/    FB84 : 81 04               	CMPA #EOT	
     696/    FB86 : 27 42               	BEQ .END	; End of transmission
     697/    FB88 : 81 01               	CMPA #SOH
     698/    FB8A : 26 35               	BNE .PFAIL	; 
     699/    FB8C : BD 00 0C            .S1A	JSR CONIN
     700/    FB8F : 91 08               	CMPA SEQ	; Does the sequence match? 
     701/    FB91 : 26 2E               	BNE .PFAIL
     702/    FB93 : BD 00 0C            	JSR CONIN	; Get inverted seq
     703/    FB96 : 43                  	COMA		; Invert
     704/    FB97 : 91 08               	CMPA SEQ	; Does it match?
     705/    FB99 : 26 26               	BNE .PFAIL
     706/    FB9B :                     	; Okay now we're at the data
     707/    FB9B : 86 80               	LDAA #128	; # of bytes in data
     708/    FB9D : 97 0A               	STAA COUNT
     709/    FB9F : BD 00 0C            .S2	JSR CONIN	
     710/    FBA2 : A7 00               	STAA 0,X	; Store byte
     711/    FBA4 : 08                  	INX		; Next address
     712/    FBA5 : 9B 09               	ADDA CSUM	; Compute checksum
     713/    FBA7 : 97 09               	STAA CSUM
     714/    FBA9 : 7A 00 0A            	DEC COUNT
     715/    FBAC : 26 F1               	BNE .S2		; Loop till we get out 128 bytes
     716/    FBAE :                     	; Get the checksum
     717/    FBAE : BD 00 0C            	JSR CONIN
     718/    FBB1 : 91 09               	CMPA CSUM
     719/    FBB3 : 26 0C               	BNE .PFAIL	; Checksum failed
     720/    FBB5 :                     	; Packet was good, ACK and continue
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 13 - 03/17/2023 02:51:32 AM


     721/    FBB5 : 86 06               	LDAA #ACK
     722/    FBB7 : 97 0B               	STAA LAST
     723/    FBB9 : BD 00 0F            	JSR CONOUT
     724/    FBBC : 7C 00 08            	INC SEQ
     725/    FBBF : 20 98               	BRA .S1
     726/    FBC1 : 86 15               .PFAIL	LDAA #NAK
     727/    FBC3 : 97 0B               	STAA LAST
     728/    FBC5 : BD 00 0F            	JSR CONOUT	; We did not recieve the packet correctly
     729/    FBC8 : 20 8F               	BRA .S1
     730/    FBCA : 39                  .END	RTS
     731/    FBCB :                     	
     732/    FBCB :                     ;-----------------------------------------------------------------------
     733/    FBCB :                     ; Send via XMODEM starting at addr X to ADDRT
     734/    FBCB :                     XMDMSEND	
     735/    FBCB : 86 00               	LDAA #0
     736/    FBCD : 97 03               	STAA BYTET
     737/    FBCF : 86 01               	LDAA #1
     738/    FBD1 : 97 08               	STAA SEQ
     739/    FBD3 : BD 00 0C            .AWAIT	JSR CONIN	; Wait for NAK to start
     740/    FBD6 : 81 15               	CMPA #NAK
     741/    FBD8 : 26 F9               	BNE .AWAIT
     742/    FBDA :                     	; Okay now send the packet
     743/    FBDA : 86 01               .S1	LDAA #SOH	; Start of packet
     744/    FBDC : BD 00 0F            	JSR CONOUT
     745/    FBDF : 96 08               	LDAA SEQ	; Sequence number
     746/    FBE1 : BD 00 0F            	JSR CONOUT
     747/    FBE4 : 43                  	COMA		; Inverted sequence
     748/    FBE5 : BD 00 0F            	JSR CONOUT
     749/    FBE8 : 86 00               	LDAA #0
     750/    FBEA : 97 09               	STAA CSUM
     751/    FBEC : 86 80               	LDAA #128	; Bytes in packet
     752/    FBEE : 97 0A               	STAA COUNT
     753/    FBF0 : DF 04               	STX ADDRP	; Save address of start of packet 
     754/    FBF2 :                     	; Now the data
     755/    FBF2 : A6 00               .S2	LDAA 0,X	; Read byte
     756/    FBF4 : BD 00 0F            	JSR CONOUT	; Send
     757/    FBF7 : 9B 09               	ADDA CSUM	; Compute checksum
     758/    FBF9 : 97 09               	STAA CSUM
     759/    FBFB : 08                  	INX		; Next address
     760/    FBFC : 9C 00               	CPX ADDRT	; Are we at the stop address yet?
     761/    FBFE : 26 03               	BNE .S2A
     762/    FC00 : 7C 00 03            	INC BYTET	; Indicate we went past the end
     763/    FC03 : 7A 00 0A            .S2A	DEC COUNT
     764/    FC06 : 26 EA               	BNE .S2
     765/    FC08 :                     	; Now the checksum
     766/    FC08 : 96 09               	LDAA CSUM
     767/    FC0A : BD 00 0F            	JSR CONOUT
     768/    FC0D :                     	; Check for ACK or NAK
     769/    FC0D : BD 00 0C            .S3	JSR CONIN
     770/    FC10 : 81 06               	CMPA #ACK
     771/    FC12 : 27 08               	BEQ .NEXT
     772/    FC14 : 81 15               	CMPA #NAK
     773/    FC16 : 26 F5               	BNE .S3		; Keep looking for response
     774/    FC18 : DE 04               .REDO	LDX ADDRP	; Reset address
     775/    FC1A : 20 BE               	BRA .S1		; Try again
     776/    FC1C : 7C 00 08            .NEXT	INC SEQ
     777/    FC1F : 7D 00 03            	TST BYTET	; Did we hit the stop address before?
     778/    FC22 : 27 B6               	BEQ .S1		; X < ADDRT
     779/    FC24 : 86 04               .DONE	LDAA #EOT
     780/    FC26 : BD 00 0F            	JSR CONOUT
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 14 - 03/17/2023 02:51:32 AM


     781/    FC29 : BD 00 0C            	JSR CONIN	; ACK?
     782/    FC2C : 81 06               	CMPA #ACK
     783/    FC2E : 26 F4               	BNE .DONE
     784/    FC30 : 86 17               .DONE2	LDAA #ETB
     785/    FC32 : BD 00 0F            	JSR CONOUT
     786/    FC35 : 39                  	RTS
     787/    FC36 :                     
     788/    FC36 :                     
     789/    FC36 : 46 45 4E 4E 45 43   S_BANNER DB "FENNEC-68MON 0.3\r\n", 0
             FC3C : 2D 36 38 4D 4F 4E 
             FC42 : 20 30 2E 33 0D 0A 
             FC48 : 00                
     790/    FC49 : 6B 42 20 4D 45 4D   S_MEM    DB "kB MEMORY\r\n",0
             FC4F : 4F 52 59 0D 0A 00 
     791/    FC55 : 54 49 4D 45 4F 55   S_TIME	 DB "TIMEOUT\r\n",0
             FC5B : 54 0D 0A 00       
     792/    FC5F : 53 45 4E 44 00      S_SEND	 DB "SEND",0
     793/    FC64 : 52 45 43 56 00      S_RECV	 DB "RECV",0 
     794/    FC69 : 20 46 49 4C 45 20   S_FILE	 DB " FILE NOW\r\n",0
             FC6F : 4E 4F 57 0D 0A 00 
     795/    FC75 : 4F 50 54 49 4F 4E   S_OPTION DB "OPTION ROMS:\r\n", 0
             FC7B : 20 52 4F 4D 53 3A 
             FC81 : 0D 0A 00          
     796/    FC84 :                     
     797/    FC84 :                     
     798/    FC84 :                     
     799/    FC84 :                     
     800/    FC84 :                     
     801/    FC84 :                     IRQHND
     802/    FC84 :                     SWIHND
     803/    FC84 :                     NMIHND	
     804/    FC84 : 20 FE               HALTL	BRA HALTL
     805/    FC86 :                     
     806/    FFF8 :                     	ORG $FFF8	; Vectors
     807/    FFF8 : FC 84               IRQV	DW IRQHND
     808/    FFFA : FC 84               SWIV	DW SWIHND
     809/    FFFC : FC 84               NMIV	DW NMIHND
     810/    FFFE : F8 00               RESV	DW START
     811/   10000 :                     
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 15 - 03/17/2023 02:51:32 AM


  Symbol Table (* = unused):
  --------------------------

 ACK :                            6 - |  ADDR1 :                       F89B C |
 ADDR2 :                       F891 C |  ADDRP :                          4 - |
 ADDRT :                          0 - |
*ARCHITECTURE :                                     "aarch64-unknown-linux" - |
 AUXIN :                         15 - |  AUXINNB :                       1B - |
 AUXOUT :                        18 - |  BANNER :                      FA59 C |
 BYTET :                          3 - | *CASESENSITIVE :                  0 - |
*COMPMODE :                       0 - |  CONIN :                          C - |
 CONINNB :                       12 - |  CONOUT :                         F - |
*CONSTPI :        3.141592653589793 - |  CONTINIT :                    FA19 C |
 CONTINIT.COPY :               FA23 C |  CONTR :                          C - |
 CONTRE :                        27 - |  COUNT :                          A - |
 CSUM :                           9 - | *DATE :                "03/17/2023" - |
 DDEVIN :                      FAB5 C |  DDEVIN.AUX :                  FAC8 C |
 DDEVIN.CON :                  FAC5 C |  DDEVIN.S0 :                   FACB C |
 DDEVIN.S1 :                   FACE C |  DDEVINNB :                    FAED C |
 DDEVINNB.AUX :                FB00 C |  DDEVINNB.CON :                FAFD C |
 DDEVINNB.S0 :                 FB03 C |  DDEVINNB.S1 :                 FB06 C |
 DDEVOUT :                     FAD1 C |  DDEVOUT.AUX :                 FAE4 C |
 DDEVOUT.CON :                 FAE1 C |  DDEVOUT.S0 :                  FAE7 C |
 DDEVOUT.S1 :                  FAEA C |  DEFRT :                       F803 C |
 DEFRTE :                      F81E C |  DEFRTLEN :                      1B - |
 DEPLOOP :                     F91B C |  DEPLOOP.DIGIT :               F94B C |
 DEPLOOP.DONE :                F961 C |  DEPLOOP.IGNORE :              F92A C |
 DEPLOOP.LOOP :                F929 C |  DEPLOOP.NEXT :                F91D C |
 DEPLOOP.T2 :                  F937 C |  DEPOSIT :                     F866 C |
 DEVIN :                         1E - |  DEVINNB :                       24 - |
 DEVOUT :                        21 - |  DUMP :                        F963 C |
 DUMP.DONE :                   F98D C |  DUMP.LOOP :                   F96F C |
 ENDROM :                        E0 - |  ENTER :                       F81E C |
 EOT :                            4 - |  ESC :                           1B - |
 ETB :                           17 - |  EXAMINE :                     F85E C |
*FALSE :                          0 - |  FINDROM :                     F8BC C |
 FINDROM.FOUND :               F8DA C |  FINDROM.LOOP :                F8BF C |
 FINDROM.NEXT :                F8CB C | *FULLPMMU :                       1 - |
 GOTO :                        F86E C |  HALTL :                       FC84 C |
*HAS64 :                          1 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *INSUPMODE :                      0 - |
 IRQHND :                      FC84 C | *IRQV :                        FFF8 C |
 LAST :                           B - | *LISTON :                         1 - |
 LOOP :                        F836 C |  LOOPI :                       F83E C |
*MACEXP :                         7 - | *MAGIC :                       F10F - |
 MAGIC0 :                        F1 - |  MAGIC1 :                         F - |
*MOMCPU :                      6800 - | *MOMCPUNAME :                "6800" - |
 MONSTK :                        FF - |  NAK :                           15 - |
*NESTMAX :                      100 - |  NEWLINE :                     FB09 C |
 NMIHND :                      FC84 C | *NMIV :                        FFFC C |
*PADDING :                        0 - |  PRINTBYTE :                   F9F2 C |
 PRINTNYB :                    F9FB C |  PRINTNYB.NOFIX :              FA05 C |
 PRINTROM :                    F8E2 C |  PRINTROM.FOUND :              F906 C |
 PRINTROM.LOOP :               F8EB C |  PRINTROM.NEXT :               F8F7 C |
 PRINTSTR :                    FB13 C |  PRINTSTR.END :                FB1D C |
 PRINTWORD :                   F9EB C |  PROMPT :                       '*' - |
 PSTART :                      8000 - |  RAMKB :                          2 - |
 RAMSIZE :                     FA2D C |  RAMSIZE.FAIL :                FA56 C |
 RAMSIZE.SIZE :                FA34 C |  RAMTOP :                      1FFF - |
 READADDR :                    F997 C |  READBYTE :                    F9A6 C |
 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 16 - 03/17/2023 02:51:32 AM


 READBYTE.DIGIT :              F9D1 C |  READBYTE.DIGIT2 :             F9D4 C |
 READBYTE.NEXT :               F9AC C |  READBYTE.NEXT2 :              F9AD C |
 READBYTE.NEXT3 :              F9BA C |  READBYTEP :                   F98E C |
*RELAXED :                        0 - | *RESV :                        FFFE C |
*ROMNLEN :                        A - | *ROMOFF :                        10 - |
*ROMSIG :                      F10F - |  ROMSPA :                         4 - |
 S0IN :                        FA6D C |  S0IN.L :                      FA6F C |
 S0IN_NB :                     FA99 C |  S0IN_NB.E :                   FAA5 C |
 S0OUT :                       FA83 C |  S0OUT.L :                     FA85 C |
 S1IN :                        FA78 C |  S1IN.L :                      FA7A C |
 S1IN_NB :                     FAA7 C |  S1IN_NB.E :                   FAB3 C |
 S1OUT :                       FA8E C |  S1OUT.L :                     FA90 C |
 SEQ :                            8 - |  SOH :                            1 - |
 START :                       F800 C |  SWIHND :                      FC84 C |
*SWIV :                        FFFA C |  S_BANNER :                    FC36 C |
 S_FILE :                      FC69 C |  S_MEM :                       FC49 C |
 S_OPTION :                    FC75 C |  S_RECV :                      FC64 C |
 S_SEND :                      FC5F C |  S_TIME :                      FC55 C |
*TIME :               "02:51:32 AM" - |  TIMER :                          6 - |
 TOUPPER :                     FB1E C |  TOUPPER.DONE :                FB28 C |
*TRUE :                           1 - |  UART1 :                       EFF0 - |
 UART2 :                       EFF2 - |  UARTINIT :                    FA08 C |
*VERSION :                     142F - |  WARMST :                      F833 C |
 XMDMRECV :                    FB29 C |  XMDMRECV.AWAIT :              FB3C C |
 XMDMRECV.END :                FBCA C |  XMDMRECV.GOT1 :               FB4D C |
 XMDMRECV.GOT2 :               FB7C C |  XMDMRECV.PFAIL :              FBC1 C |
 XMDMRECV.S1 :                 FB59 C |  XMDMRECV.S1A :                FB8C C |
 XMDMRECV.S2 :                 FB9F C |  XMDMRECV.START :              FB35 C |
 XMDMRECV.TIMEOUT :            FB73 C |  XMDMSEND :                    FBCB C |
 XMDMSEND.AWAIT :              FBD3 C |  XMDMSEND.DONE :               FC24 C |
*XMDMSEND.DONE2 :              FC30 C |  XMDMSEND.NEXT :               FC1C C |
*XMDMSEND.REDO :               FC18 C |  XMDMSEND.S1 :                 FBDA C |
 XMDMSEND.S2 :                 FBF2 C |  XMDMSEND.S2A :                FC03 C |
 XMDMSEND.S3 :                 FC0D C |  XMSG :                        F8A5 C |
 XMSG.RECV :                   F8B0 C |  XRECV :                       F877 C |
 XSEND :                       F884 C |

    183 symbols
     31 unused symbols

 AS V1.42 Beta [Bld 237] - Source File monitor.asm - Page 17 - 03/17/2023 02:51:32 AM


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.03 seconds assembly time

    811 lines source file
      2 passes
      0 errors
      0 warnings
